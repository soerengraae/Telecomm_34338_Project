\doxysection{Outdoor\+\_\+\+Unit/outdoorunit/outdoorunit.ino File Reference}
\hypertarget{outdoorunit_8ino}{}\label{outdoorunit_8ino}\index{Outdoor\_Unit/outdoorunit/outdoorunit.ino@{Outdoor\_Unit/outdoorunit/outdoorunit.ino}}


Outdoor unit for weather monitoring and data transmission.  


{\ttfamily \#include "{}DHT.\+h"{}}\newline
{\ttfamily \#include "{}Wi\+Fi.\+h"{}}\newline
{\ttfamily \#include "{}HTTPClient.\+h"{}}\newline
{\ttfamily \#include "{}Arduino\+Json.\+h"{}}\newline
{\ttfamily \#include "{}Thing\+Speak.\+h"{}}\newline
{\ttfamily \#include "{}secrets.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+now.\+h"{}}\newline
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structpacket}{packet}}
\begin{DoxyCompactList}\small\item\em Structure to hold weather data for transmission. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{outdoorunit_8ino_a1481e2e73ead95154830a58de486cb2e}{DHT11\+Pin}}~5
\item 
\#define \mbox{\hyperlink{outdoorunit_8ino_a710340e2388b9f9ad3eb87b6f979af42}{wind\+Pin}}~35
\item 
\#define \mbox{\hyperlink{outdoorunit_8ino_ad00b753306ae72af33e1a360193ada86}{light\+Pin}}~26
\item 
\#define \mbox{\hyperlink{outdoorunit_8ino_a4a0a4aa5db390e405fce9272877d4704}{forecast\+Weather\+URL}}~"{}http\+://api.\+openweathermap.\+org/data/2.\+5/forecast?lat=55.\+78598981728918\&lon=12.\+522723007973173\&units=metric\&appid=APIHERE"{}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
DHT \mbox{\hyperlink{outdoorunit_8ino_ae020b4c28bfae6d1b1550584075c7213}{dht11}} (\mbox{\hyperlink{outdoorunit_8ino_a1481e2e73ead95154830a58de486cb2e}{DHT11\+Pin}}, DHT11)
\item 
void \mbox{\hyperlink{outdoorunit_8ino_a1ec6b84c5d1247e1390758d6df12d0dc}{On\+Data\+Sent}} (const uint8\+\_\+t \texorpdfstring{$\ast$}{*}mac\+\_\+addr, esp\+\_\+now\+\_\+send\+\_\+status\+\_\+t status)
\begin{DoxyCompactList}\small\item\em Callback function called when data is sent via ESP-\/\+NOW. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{outdoorunit_8ino_a4fc01d736fe50cf5b977f755b675f11d}{setup}} ()
\begin{DoxyCompactList}\small\item\em Setup function initializes serial communication, DHT11 sensor, and light sensor pin. \end{DoxyCompactList}\item 
int8\+\_\+t \mbox{\hyperlink{outdoorunit_8ino_acb4dc83e53bfebae6d753102470d94cc}{fetch\+Rain\+Status}} ()
\begin{DoxyCompactList}\small\item\em Fetches the rain status from the Open\+Weather\+Map forecast API. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{outdoorunit_8ino_a66e3fe8bc97521ff09c211001a38a488}{collect\+Real\+Weather}} ()
\begin{DoxyCompactList}\small\item\em Collects real-\/time weather data from sensors. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{outdoorunit_8ino_aa7fb0631e0b6759d8791aae6c9f1e486}{average\+Wind\+Speed}} ()
\begin{DoxyCompactList}\small\item\em Calculates the average wind speed over a sampling period. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{outdoorunit_8ino_ab5fc4415d456afb7c4fb755642a131af}{fill\+Packet}} (\mbox{\hyperlink{structpacket}{packet}} \texorpdfstring{$\ast$}{*}pck)
\begin{DoxyCompactList}\small\item\em Fills the packet structure with current weather data. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{outdoorunit_8ino_a2d76cb22f9e5de30c2f19119123b3c49}{send\+Packet}} (\mbox{\hyperlink{structpacket}{packet}} pck)
\begin{DoxyCompactList}\small\item\em Sends the weather data packet via ESP-\/\+NOW. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{outdoorunit_8ino_afe461d27b9c48d5921c00d521181f12f}{loop}} ()
\begin{DoxyCompactList}\small\item\em Main loop function. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
uint8\+\_\+t \mbox{\hyperlink{outdoorunit_8ino_a3cc119cb1a4beab046568bd21fcac3e5}{temp}} = 0
\item 
uint8\+\_\+t \mbox{\hyperlink{outdoorunit_8ino_a3cb62182097ceb535c2f31919c98a0b6}{humidity}} = 0
\item 
uint16\+\_\+t \mbox{\hyperlink{outdoorunit_8ino_a0d97458b76e85fb7222cea3939288ac0}{wind\+Speed}} = 0
\item 
uint8\+\_\+t \mbox{\hyperlink{outdoorunit_8ino_a1374fe0572defa7d6c15413f96794ded}{light\+Status}} = 0
\item 
Wi\+Fi\+Client \mbox{\hyperlink{outdoorunit_8ino_a323dfc205549b3c13f0a25c1b670708a}{client}}
\item 
uint8\+\_\+t \mbox{\hyperlink{outdoorunit_8ino_a3725ad8cc4ac1b5881384ccd184fa249}{broadcast\+Address}} \mbox{[}$\,$\mbox{]} = \{ 0x08, 0x3A, 0x\+F2, 0x8E, 0x\+EC, 0x58 \}
\item 
esp\+\_\+now\+\_\+peer\+\_\+info\+\_\+t \mbox{\hyperlink{outdoorunit_8ino_a460dd048dadae7ce7815b6d61b7084f6}{peer\+Info}}
\item 
int8\+\_\+t \mbox{\hyperlink{outdoorunit_8ino_a58dd369d52256fa12a68256e014a210b}{rain\+Status}} = 0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Outdoor unit for weather monitoring and data transmission. 

This file collects real-\/time weather data using sensors and fetches forecast data from Open\+Weather\+Map API. The collected data is then sent via ESP-\/\+NOW to a designated peer. 

\doxysubsection{Macro Definition Documentation}
\Hypertarget{outdoorunit_8ino_a1481e2e73ead95154830a58de486cb2e}\index{outdoorunit.ino@{outdoorunit.ino}!DHT11Pin@{DHT11Pin}}
\index{DHT11Pin@{DHT11Pin}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{DHT11Pin}{DHT11Pin}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a1481e2e73ead95154830a58de486cb2e} 
\#define DHT11\+Pin~5}

GPIO pin connected to DHT11 sensor \Hypertarget{outdoorunit_8ino_a4a0a4aa5db390e405fce9272877d4704}\index{outdoorunit.ino@{outdoorunit.ino}!forecastWeatherURL@{forecastWeatherURL}}
\index{forecastWeatherURL@{forecastWeatherURL}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{forecastWeatherURL}{forecastWeatherURL}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a4a0a4aa5db390e405fce9272877d4704} 
\#define forecast\+Weather\+URL~"{}http\+://api.\+openweathermap.\+org/data/2.\+5/forecast?lat=55.\+78598981728918\&lon=12.\+522723007973173\&units=metric\&appid=APIHERE"{}}

URL for fetching weather forecast \Hypertarget{outdoorunit_8ino_ad00b753306ae72af33e1a360193ada86}\index{outdoorunit.ino@{outdoorunit.ino}!lightPin@{lightPin}}
\index{lightPin@{lightPin}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{lightPin}{lightPin}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_ad00b753306ae72af33e1a360193ada86} 
\#define light\+Pin~26}

GPIO pin connected to light sensor \Hypertarget{outdoorunit_8ino_a710340e2388b9f9ad3eb87b6f979af42}\index{outdoorunit.ino@{outdoorunit.ino}!windPin@{windPin}}
\index{windPin@{windPin}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{windPin}{windPin}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a710340e2388b9f9ad3eb87b6f979af42} 
\#define wind\+Pin~35}

GPIO pin connected to wind speed sensor 

\doxysubsection{Function Documentation}
\Hypertarget{outdoorunit_8ino_aa7fb0631e0b6759d8791aae6c9f1e486}\index{outdoorunit.ino@{outdoorunit.ino}!averageWindSpeed@{averageWindSpeed}}
\index{averageWindSpeed@{averageWindSpeed}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{averageWindSpeed()}{averageWindSpeed()}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_aa7fb0631e0b6759d8791aae6c9f1e486} 
int average\+Wind\+Speed (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Calculates the average wind speed over a sampling period. 

Samples the wind speed sensor at regular intervals and computes the average.

\begin{DoxyReturn}{Returns}
int Average wind speed. 
\end{DoxyReturn}
\texorpdfstring{$<$}{<} Sampling interval in milliseconds

\texorpdfstring{$<$}{<} Number of samples

Values calibrated from Arduino changed from 10 to 12 bit, equations updated accordingly

\texorpdfstring{$<$}{<} Convert voltage to wind speed\Hypertarget{outdoorunit_8ino_a66e3fe8bc97521ff09c211001a38a488}\index{outdoorunit.ino@{outdoorunit.ino}!collectRealWeather@{collectRealWeather}}
\index{collectRealWeather@{collectRealWeather}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{collectRealWeather()}{collectRealWeather()}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a66e3fe8bc97521ff09c211001a38a488} 
void collect\+Real\+Weather (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Collects real-\/time weather data from sensors. 

Reads temperature, humidity, and wind speed from respective sensors. \Hypertarget{outdoorunit_8ino_ae020b4c28bfae6d1b1550584075c7213}\index{outdoorunit.ino@{outdoorunit.ino}!dht11@{dht11}}
\index{dht11@{dht11}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{dht11()}{dht11()}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_ae020b4c28bfae6d1b1550584075c7213} 
DHT dht11 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{outdoorunit_8ino_a1481e2e73ead95154830a58de486cb2e}{DHT11\+Pin}}}]{}{, }\item[{DHT11}]{}{}\end{DoxyParamCaption})}

DHT11 sensor instance \Hypertarget{outdoorunit_8ino_acb4dc83e53bfebae6d753102470d94cc}\index{outdoorunit.ino@{outdoorunit.ino}!fetchRainStatus@{fetchRainStatus}}
\index{fetchRainStatus@{fetchRainStatus}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{fetchRainStatus()}{fetchRainStatus()}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_acb4dc83e53bfebae6d753102470d94cc} 
int8\+\_\+t fetch\+Rain\+Status (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Fetches the rain status from the Open\+Weather\+Map forecast API. 

Connects to Wi\+Fi, retrieves forecast data, parses JSON response, and determines rain status.

\begin{DoxyReturn}{Returns}
int8\+\_\+t Rain status\+:
\begin{DoxyItemize}
\item 0\+: No rain
\item 1\+: Rain in the first interval
\item 2\+: Rain in the second interval
\item 3\+: Rain in both intervals 
\end{DoxyItemize}
\end{DoxyReturn}
\Hypertarget{outdoorunit_8ino_ab5fc4415d456afb7c4fb755642a131af}\index{outdoorunit.ino@{outdoorunit.ino}!fillPacket@{fillPacket}}
\index{fillPacket@{fillPacket}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{fillPacket()}{fillPacket()}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_ab5fc4415d456afb7c4fb755642a131af} 
void fill\+Packet (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structpacket}{packet}} \texorpdfstring{$\ast$}{*}}]{pck}{}\end{DoxyParamCaption})}



Fills the packet structure with current weather data. 


\begin{DoxyParams}{Parameters}
{\em pck} & Pointer to the packet structure to be filled. \\
\hline
\end{DoxyParams}
\Hypertarget{outdoorunit_8ino_afe461d27b9c48d5921c00d521181f12f}\index{outdoorunit.ino@{outdoorunit.ino}!loop@{loop}}
\index{loop@{loop}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{loop()}{loop()}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_afe461d27b9c48d5921c00d521181f12f} 
void loop (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Main loop function. 

Periodically collects weather data, fetches rain status, fills the packet, and sends it. \texorpdfstring{$<$}{<} Wait before starting data collection

\texorpdfstring{$<$}{<} Wait before sending data

\texorpdfstring{$<$}{<} Wait before next loop iteration\Hypertarget{outdoorunit_8ino_a1ec6b84c5d1247e1390758d6df12d0dc}\index{outdoorunit.ino@{outdoorunit.ino}!OnDataSent@{OnDataSent}}
\index{OnDataSent@{OnDataSent}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{OnDataSent()}{OnDataSent()}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a1ec6b84c5d1247e1390758d6df12d0dc} 
void On\+Data\+Sent (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{mac\+\_\+addr}{, }\item[{esp\+\_\+now\+\_\+send\+\_\+status\+\_\+t}]{status}{}\end{DoxyParamCaption})}



Callback function called when data is sent via ESP-\/\+NOW. 


\begin{DoxyParams}{Parameters}
{\em mac\+\_\+addr} & MAC address of the receiver. \\
\hline
{\em status} & Status of the send operation. \\
\hline
\end{DoxyParams}
\Hypertarget{outdoorunit_8ino_a2d76cb22f9e5de30c2f19119123b3c49}\index{outdoorunit.ino@{outdoorunit.ino}!sendPacket@{sendPacket}}
\index{sendPacket@{sendPacket}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{sendPacket()}{sendPacket()}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a2d76cb22f9e5de30c2f19119123b3c49} 
void send\+Packet (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structpacket}{packet}}}]{pck}{}\end{DoxyParamCaption})}



Sends the weather data packet via ESP-\/\+NOW. 

Initializes ESP-\/\+NOW, registers the send callback, adds the peer, and sends the packet.


\begin{DoxyParams}{Parameters}
{\em pck} & The packet structure containing weather data to be sent. \\
\hline
\end{DoxyParams}
\Hypertarget{outdoorunit_8ino_a4fc01d736fe50cf5b977f755b675f11d}\index{outdoorunit.ino@{outdoorunit.ino}!setup@{setup}}
\index{setup@{setup}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{setup()}{setup()}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a4fc01d736fe50cf5b977f755b675f11d} 
void setup (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Setup function initializes serial communication, DHT11 sensor, and light sensor pin. 



\doxysubsection{Variable Documentation}
\Hypertarget{outdoorunit_8ino_a3725ad8cc4ac1b5881384ccd184fa249}\index{outdoorunit.ino@{outdoorunit.ino}!broadcastAddress@{broadcastAddress}}
\index{broadcastAddress@{broadcastAddress}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{broadcastAddress}{broadcastAddress}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a3725ad8cc4ac1b5881384ccd184fa249} 
uint8\+\_\+t broadcast\+Address\mbox{[}$\,$\mbox{]} = \{ 0x08, 0x3A, 0x\+F2, 0x8E, 0x\+EC, 0x58 \}}

Broadcast address for ESP-\/\+NOW communication \Hypertarget{outdoorunit_8ino_a323dfc205549b3c13f0a25c1b670708a}\index{outdoorunit.ino@{outdoorunit.ino}!client@{client}}
\index{client@{client}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{client}{client}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a323dfc205549b3c13f0a25c1b670708a} 
Wi\+Fi\+Client client}

Wi\+Fi client for HTTP requests \Hypertarget{outdoorunit_8ino_a3cb62182097ceb535c2f31919c98a0b6}\index{outdoorunit.ino@{outdoorunit.ino}!humidity@{humidity}}
\index{humidity@{humidity}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{humidity}{humidity}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a3cb62182097ceb535c2f31919c98a0b6} 
uint8\+\_\+t humidity = 0}

Current humidity reading \Hypertarget{outdoorunit_8ino_a1374fe0572defa7d6c15413f96794ded}\index{outdoorunit.ino@{outdoorunit.ino}!lightStatus@{lightStatus}}
\index{lightStatus@{lightStatus}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{lightStatus}{lightStatus}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a1374fe0572defa7d6c15413f96794ded} 
uint8\+\_\+t light\+Status = 0}

Current light status \Hypertarget{outdoorunit_8ino_a460dd048dadae7ce7815b6d61b7084f6}\index{outdoorunit.ino@{outdoorunit.ino}!peerInfo@{peerInfo}}
\index{peerInfo@{peerInfo}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{peerInfo}{peerInfo}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a460dd048dadae7ce7815b6d61b7084f6} 
esp\+\_\+now\+\_\+peer\+\_\+info\+\_\+t peer\+Info}

ESP-\/\+NOW peer information \Hypertarget{outdoorunit_8ino_a58dd369d52256fa12a68256e014a210b}\index{outdoorunit.ino@{outdoorunit.ino}!rainStatus@{rainStatus}}
\index{rainStatus@{rainStatus}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{rainStatus}{rainStatus}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a58dd369d52256fa12a68256e014a210b} 
int8\+\_\+t rain\+Status = 0}

Current rain status \Hypertarget{outdoorunit_8ino_a3cc119cb1a4beab046568bd21fcac3e5}\index{outdoorunit.ino@{outdoorunit.ino}!temp@{temp}}
\index{temp@{temp}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{temp}{temp}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a3cc119cb1a4beab046568bd21fcac3e5} 
uint8\+\_\+t temp = 0}

Current temperature reading \Hypertarget{outdoorunit_8ino_a0d97458b76e85fb7222cea3939288ac0}\index{outdoorunit.ino@{outdoorunit.ino}!windSpeed@{windSpeed}}
\index{windSpeed@{windSpeed}!outdoorunit.ino@{outdoorunit.ino}}
\doxysubsubsection{\texorpdfstring{windSpeed}{windSpeed}}
{\footnotesize\ttfamily \label{outdoorunit_8ino_a0d97458b76e85fb7222cea3939288ac0} 
uint16\+\_\+t wind\+Speed = 0}

Current wind speed reading 